<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Boat Drive (Click-to-Run)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: system-ui, sans-serif; display:flex; flex-direction:column; gap:12px; max-width:420px; margin:20px auto; }
    .row { display:flex; gap:12px; }
    button { flex:1; padding:18px; font-size:18px; border-radius:12px; border:1px solid #ccc; cursor:pointer; }
    .big { background:#d00; color:#fff; font-weight:700; }
    .active { outline: 3px solid #09f; }
    label { display:flex; align-items:center; gap:8px; }
    input[type=number]{ width:80px; }
  </style>
</head>
<body>
  <h2>Boat Drive (Click-to-Run)</h2>

  <div class="row">
    <button id="forward">↑ Forward</button>
  </div>
  <div class="row">
    <button id="left">← Left</button>
    <button id="stop">■ Stop</button>
    <button id="right">Right →</button>
  </div>
  <div class="row">
    <button id="reverse">↓ Reverse</button>
  </div>
  <div class="row">
    <button id="estop" class="big">EMERGENCY STOP</button>
    <button id="reset">Reset E-Stop</button>
  </div>

  <label>Speed % <input id="speed" type="number" min="0" max="100" value="50"></label>
  <label>Yaw % <input id="yaw" type="number" min="0" max="100" value="60"></label>

  <script>
    function num(id){ return Math.max(0, Math.min(100, parseFloat(document.getElementById(id).value)||0)); }
    const btns = {
      forward: document.getElementById('forward'),
      reverse: document.getElementById('reverse'),
      left:    document.getElementById('left'),
      right:   document.getElementById('right'),
      stop:    document.getElementById('stop'),
      estop:   document.getElementById('estop'),
      reset:   document.getElementById('reset')
    };
    function setActive(which){
      ['forward','reverse','left','right'].forEach(k=>btns[k].classList.toggle('active', k===which));
    }
    async function post(path, body){
      try{
        const r = await fetch(path,{method:'POST',headers:{'Content-Type':'application/json'},body: body?JSON.stringify(body):null});
        return await r.json();
      }catch(e){ console.warn(e); return {ok:false, error:'fetch failed'}; }
    }

    btns.forward.onclick = ()=>{ post('/command', {mode:'forward', speed:num('speed')}); setActive('forward'); };
    btns.reverse.onclick = ()=>{ post('/command', {mode:'reverse', speed:num('speed')}); setActive('reverse'); };
    btns.left.onclick    = ()=>{ post('/command', {mode:'left',    yaw:num('yaw')  }); setActive('left'); };
    btns.right.onclick   = ()=>{ post('/command', {mode:'right',   yaw:num('yaw')  }); setActive('right'); };
    btns.stop.onclick    = ()=>{ post('/stop'); setActive(null); };
    btns.estop.onclick   = ()=>{ post('/estop'); setActive(null); };
    btns.reset.onclick   = ()=>{ post('/reset'); setActive(null); };
  </script>
</body>
</html>
